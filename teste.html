<!DOCTYPE html>
<html lang="pt-br">

<head>

    <meta charset="utf-8">
    <meta name="view-port" content="width=width-device, initial-scale=1.0, shrink-to-fit=no">
    <title>Trabalho de Sistemas Operacionais</title>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="teste.css" rel="stylesheet">

</head>

<body>

    <header>
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
            <div class="container-fluid">
                <form class="form-inline">
                    <button class="btn btn-outline-dark control" type="button" onclick="sidebar()"><i class="text-light fas fa-bars"></i></button>
                    <div class="vl"></div>
                    <button class="btn btn-success ml-4" type="button" onclick="tempo(); run();"><i class="fas fa-play"></i></button>
                    <button class="btn btn-warning text-white" type="button" onclick="pause()"><i class="fas fa-pause"></i></i></button>
                    <button class="btn btn-danger" type="button" onclick="stop()"><i class="fas fa-stop"></i></i></button>
                </form>
                <ul class="navbar-nav p-1" style="color: #C0C0C0; font-size: 0.85em;">
                    <li id="tempo" class="nav-item ml-5 text-center"><span class="" href="#">TEMPO<br>0</span></li>
                    <li id="processo" class="nav-item ml-5 text-center"><span class="" href="#">PROCESSOS<br>0</span></li>
                    <li class="nav-item ml-5 text-center"><span class="" href="#">MEMÓRIA LIVRE<br>1</span></li>
                </ul>
            </div>
        </nav>
    </header>

    <div id="mySidenav" class="sidenav text-white">
        <div class="p-3" style="display: block; transition: 0.3s;">
            <h5 class="text-center">Algoritmos</h5>
            <hr style="background-color: #C8C8C8;">
            <form>
                <div class="form-group">    
                    <div class="row">   
                        <div class="col-6">             
                            <label for="escalonamento">Escalonamento</label>
                            <select class="form-control custom-select" id="escalonamento" onchange="desabilitar()" style="font-size:0.9em;">
                                <option value="none">[Selecione]</option>
                                <option value="fifo">FIFO</option>
                                <option value="rr">Round Robin</option>
                                <option value="edf">EDF</option>
                                <option value="sjf">SJF</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label for="paginacao">Paginação</label>
                            <select class="form-control custom-select"  id="paginacao" style="font-size:0.9em;">
                                <option>FIFO</option>
                                <option>MRU</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label for="quantum">Quantum</label>
                            <input class="form-control" type="number" id="quantum" min="1" style="font-size:0.9em;">
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label for="sobrecarga">Sobrecarga</label>
                            <input class="form-control" type="number" id="sobrecarga" min="1" max="5" style="font-size:0.9em;">
                        </div>
                    </div>
                </div>
            </form>

            <h5 class="text-center">Gerenciador de Processos</h5>
            <hr style="background-color: #C8C8C8;">
            <div class="row">
                <span class="col-8 scroll mt-2">
                    <table class="table-hover table-sm">
                        <thead>
                            <tr>
                                <th>COR</th>
                                <th>PID</th>
                                <th>TC</th>
                                <th>TE</th>
                                <th>TR</th>
                                <th>DD</th>
                                <th title="PRIORIDADE">PR</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-processos">
                            
                        </tbody>
                    </table>
                </span>

                <div class="col-4 mt-2">
                    <button class="btn btn-block btn-midnight" type="button" data-toggle="modal" data-target="#criar-processo" style="font-size: 0.7em;"><strong>Criar</strong></button>
                    <button class="btn btn-block btn-midnight" type="button" style="font-size: 0.7em;"><strong>Suspender</strong></button>
                    <button class="btn btn-block btn-midnight" type="button" style="font-size: 0.7em;"><strong>Prosseguir</strong></button>
                    <button class="btn btn-block btn-midnight" type="button" style="font-size: 0.7em;"><strong>Finalizar</strong></button>
                    <button class="btn btn-block btn-midnight" type="button" style="font-size: 0.7em;"><strong>Prioridade</strong></button>
                    <button class="btn btn-block btn-midnight" type="button" style="font-size: 0.7em;"><strong>PCB</strong></button>
                </div>
            </div>
        </div>
    </div>

    <div id="main" class="pt-5 pl-0 pr-2 mt-4">
        <div id="criar-processo" class="modal fade">
            <div class="modal-dialog modal-dialog-centered" style="width: 25em; font-family: robotoBold;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Criar Processo</h4>
                        <button type="button" class="close" data-dismiss="modal">&times</button>
                    </div>

                    <form>

                        <div class="modal-body">
                            
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-6">
                                        <label for="tempo-chegada">Tempo de Chegada</label>
                                        <input type="number" class="form-control" id="tempo-chegada" min="0" required> 
                                    </div>
                                    <div class="col-6">
                                        <label for="prioridade">Prioridade</label>
                                        <input type="number" class="form-control" id="prioridade" min="0" required> 
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <label for="tempo-execucao">Tempo de Execução</label>
                                        <input type="number" class="form-control" id="tempo-execucao" min="0" required> 
                                    </div>
                                    <div class="col-6">
                                        <label for="deadline">Deadline</label>
                                        <input type="number" class="form-control" id="deadline" min="0" required> 
                                    </div>
                                </div>
                            </div>
                            
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-success" type="submit" data-dismiss="modal" onclick="criar_processo()">Confirmar</button>
                            <button class="btn btn-info" type="button" onclick="criar_processo()">Confirmar e Criar Novo</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <div class="container-fluid ">
            <div class="row">
                <div class="col-4">
                    <div class="gerenciador-processador shadow ">
                        <h6 class="text-center mb-2">Gerenciador do Processador</h6>

                        <p class="text-center">CPU</p>
                        <div class="row mb-2">
                            <div class="offset-5 col-2 d-flex justify-content-center" style="height: 3em; border: 2px solid black;" >
                                <i id="circulo" class="fas fa-circle mt-2" style="font-size: 1.5em; display: none;"></i>
                            </div>
                        </div>

                        <p>PRONTOS</p>
                        <div class="row mb-3">
                            <div class="filas ml-3">
                                <table>
                                    <tbody>
                                        <tr id="fila-prontos">
                                            
                                        </tr>
                                    </tbody>
                                </table>
                            </div>  
                        </div>

                        <p>ESPERA</p>
                        <div class="row mb-3">
                            <div class="ml-3 filas">
                                <table>
                                    <tbody>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>  
                        </div>


                    </div>
                </div>
                <div id="grafico-gantt" class="col-8 scroll-gantt">
                   
                </div>
            </div>

            <div class="row mt-3">

                <div class="col-4">
                    <div class="gerenciador-processos shadow">
                        <h6 class="text-center">Tabela de Páginas</h6>
                        <div class="row">
                            <div class="offset-3 col-2 bg-info">
                                MEMORIA VIRTUAL
                            </div>

                            <div class="offset-2 col-2 bg-success">
                                MEMORIA FISICA
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-4">
                    <div class="gerenciador-processos shadow">
                        <h6 class="text-center mb-5">RAM</h6>
                        <div class="filas">
                            <table class="table-sm">
                                <tbody>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>


                    </div>
                </div>

                <div class="col-4">
                    <div class="gerenciador-processos shadow">
                        <h6 class="text-center">Disco</h6>

                        <div class="scroll-disco mt-2">
                            <table class="m-auto" style="border: 1px solid #c0c0c0; width: 50%;">
                                <tbody id="disco">
                                    
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div> 

    <script type="text/javascript">
        var PID = 0;
        var temporestante = 0;
        var FIFO = [];
        var RR = [];
        var tempo;
        let seed = 0.753;
        let seg = 0;
        let start;
        let processos = 0;
        let executando = false;
        let contador = 0;
        let espera = [];
        let curTime = 0;

        let tChegada = parseInt(document.getElementById('tempo-chegada').value);
        let tExecucao = parseInt(document.getElementById('tempo-execucao').value);
        let prioridade = parseInt(document.getElementById('prioridade').value);
        let deadline = parseInt(document.getElementById('deadline').value);

        let escalonamento = document.getElementById('escalonamento').value;
        let paginacao = document.getElementById('paginacao').value;

        function tempo() {
            seg++;

            document.getElementById('tempo').innerHTML = '<span class="" href="#">TEMPO<br>' + seg + '</span>';
            document.getElementById('processo').innerHTML = '<span class="" href="#">PROCESSOS<br>' + processos + '</span>';

            start = setTimeout(tempo, 1000);
        }

        function pause() {
            clearTimeout(start);
        }

        function stop() {
            clearTimeout(start);
            seg = 0;
            document.getElementById('tempo').innerHTML = '<span class="" href="#">TEMPO<br>' + seg + '</span>';
        }

        function sleep(miliseconds) {
           var currentTime = new Date().getTime();

           while (currentTime + miliseconds >= new Date().getTime()) {}
        }

        function fifo() {
            curTime = 0;

            document.getElementById(FIFO[0][1]).style.display = 'none';
            document.getElementById('circulo').style.display = 'block';
            document.getElementById('circulo').style.color = FIFO[0][0];  
            contador++;
            if(contador <= FIFO[0][3]){
                document.getElementById(FIFO[0][0]).innerHTML += '<i class="fas fa-square-full text-success"></i>';
                curTime++;
                for(i = 1; i < FIFO.length; i++){
                    if(espera[i] <= curTime - FIFO[i][2]){
                        document.getElementById(FIFO[i][0]).innerHTML += '<i class="fas fa-square-full text-warning"></i>';
                        espera[i]++;
                    }
                }
                setTimeout(fifo, 1000);
            } else {
                FIFO.shift();
                espera.shift();
                processos--;
                document.getElementById('processo').innerHTML = '<span class="" href="#">PROCESSOS<br>' + processos + '</span>';
                if(FIFO.length > 0){
                    contador = 0;
                    for(i=0; i<espera.length; i++){
                        espera[i] = 0;
                    }
                    fifo();
                } else {
                    document.getElementById('circulo').style.display = 'none';
                }

            }
        }

        function remove(parent,child){
            let p = document.getElementById(parent);
            let c = document.getElementById(child);
            p.removeChild(c);
        }

        function rr(){
            let terminou = false;

            document.getElementById(RR[0][1]).style.display = 'none';
            document.getElementById('circulo').style.display = 'block';
            document.getElementById('circulo').style.color = RR[0][0];  
            contador++;
            if(RR[0][3] != 0 ){
                if(contador <= parseInt(document.getElementById('quantum').value)){
                    document.getElementById(RR[0][0]).innerHTML += '<i class="fas fa-square-full text-success"></i>';
                    for(i = 1; i < RR.length; i++){
                        if(espera[i] <= (curTime - RR[i][2])+1){
                            document.getElementById(RR[i][0]).innerHTML += '<i class="fas fa-square-full text-warning"></i>';
                            espera[i]++;
                        }
                    }
                    curTime++;
                    setTimeout(rr, 1000);
                } else {
                    let p = RR.shift();
                    espera.shift();
                    remove('fila-prontos', p[1]);
                    p[3] -= parseInt(document.getElementById('quantum').value);
                    if(p[3] > 0){
                        RR.push(p);
                        espera.push(0);
                        document.getElementById('fila-prontos').innerHTML += '<td id="' + p[1]+ '" width="10%" style="background-color:' + p[0] + ';"></td>';
                        document.getElementById('circulo').style.display = 'none';
                    } else {
                        terminou = true;
                    }
                    
                    if(RR.length > 0){
                        contador = 0;
                        if(terminou){
                            terminou = false;
                            rr()
                        } else {
                            document.getElementById(p[0]).innerHTML += '<i class="fas fa-square-full text-danger"></i>';
                            for(i = 0; i < RR.length-1; i++){
                                document.getElementById(RR[i][0]).innerHTML += '<i class="fas fa-square-full text-warning"></i>';
                            }
                            setTimeout(rr, parseInt(document.getElementById('sobrecarga').value) * 1000);
                        }
                    } else {
                        document.getElementById('circulo').style.display = 'none';
                        processos--;
                        document.getElementById('processo').innerHTML = '<span class="" href="#">PROCESSOS<br>' + processos + '</span>';
                    }
                }

            } else {
                document.getElementById('circulo').style.display = 'none';
                processos--;
                document.getElementById('processo').innerHTML = '<span class="" href="#">PROCESSOS<br>' + processos + '</span>';
            }
        }
        
        function desabilitar() {
            if(document.getElementById('escalonamento').value  == 'fifo' || document.getElementById('escalonamento').value  == 'sjf'){
                document.getElementById('quantum').readOnly = true;
                document.getElementById('sobrecarga').readOnly = true;

            } else {
                document.getElementById('quantum').readOnly = false;
                document.getElementById('sobrecarga').readOnly = false;
            }
        }

        function random() {
           seed /= 1125899839733759;  // um número primo
           seed *= 18014398241046527; // outro
           seed -= parseInt(seed);         // normalizar
           return seed;
        }

        function aleatorio(inferior,superior){  
           numPossibilidades = superior - inferior;
           aleat = random() * numPossibilidades;
           aleat = Math.floor(aleat);
           return parseInt(inferior) + aleat;
        } 

        function dar_cor_aleatoria(){
           hexadecimal = new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");
           cor_aleatoria = "#";
           for (i=0;i<6;i++){
              posarray = aleatorio(0,hexadecimal.length);
              cor_aleatoria += hexadecimal[posarray];
           }
           return cor_aleatoria;
        }

        function criar_processo() {
            let quadrados = '';
            let cor = dar_cor_aleatoria();

            PID++;

            document.getElementById('tabela-processos').innerHTML += '<tr><td style="background-color:' + cor + ';"></td><td>' + PID + '</td><td>' + document.getElementById("tempo-chegada").value + '</td><td>' + document.getElementById("tempo-execucao").value + '</td><td>' + temporestante + '</td><td>' + document.getElementById("deadline").value + '</td><td>' + document.getElementById("prioridade").value + '</td></tr>';

            document.getElementById('disco').innerHTML += '<tr><td style="border: 0px">P' + PID + '</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';

            processos++;

            FIFO.push([cor, PID, parseInt(document.getElementById('tempo-chegada').value), parseInt(document.getElementById('tempo-execucao').value)]);
            RR.push([cor, PID, parseInt(document.getElementById('tempo-chegada').value), parseInt(document.getElementById('tempo-execucao').value)]);

            FIFO.sort(function(a, b) {
                return a[2]-b[2];
            });

            RR.sort(function(a, b) {
                return a[2]-b[2];
            });

            espera.push(0);

            if(executando){
                for(j = 0; j < parseInt(document.getElementById("tempo-chegada").value); j++){
                    quadrados += '<i class="fas fa-square-full text-white"></i>';
                }

                document.getElementById('grafico-gantt').innerHTML += '<div class="row mt-1" style="font-size: 1.5em;"><span>P' + PID + quadrados + '<i class="fas fa-square-full"></i></span></div>';
            }
        }

        function sidebar() {
            if(document.getElementById("mySidenav").style.width == "21em"){
                document.getElementById("mySidenav").style.width = "0";
            } else {
                document.getElementById("mySidenav").style.width = "21em";
            }
        }

        function run() {

            executando = true;
            contador = 0;
            curTime = 0;

            if(document.getElementById('escalonamento').value == 'fifo') {
                if(FIFO.length != 0){
                    for(i=0; i < FIFO.length; i++){
                        quadrados = '';
                        for(j = 0; j <= FIFO[i][2]; j++){
                            quadrados += '<i class="fas fa-square-full text-white"></i>';
                        }

                        document.getElementById('grafico-gantt').innerHTML += '<div id="'+ FIFO[i][0] + '" class="row mt-1" style="font-size: 1.5em;"><span id="grafico">P' + FIFO[i][1] + quadrados + '</span></div>';

                        document.getElementById('fila-prontos').innerHTML += '<td id="' + FIFO[i][1]+ '" width="10%" style="background-color:' + FIFO[i][0] + ';"></td>';
                    }
                    fifo();
                }
            } else if(document.getElementById('escalonamento').value == 'rr') {
                if(RR.length != 0){
                    for(i=0; i < RR.length; i++){
                        quadrados = '';
                        for(j = 0; j <= RR[i][2]; j++){
                            quadrados += '<i class="fas fa-square-full text-white"></i>';
                        }

                        document.getElementById('grafico-gantt').innerHTML += '<div id="'+ RR[i][0] + '" class="row mt-1" style="font-size: 1.5em;"><span id="grafico">P' + RR[i][1] + quadrados + '</span></div>';

                        document.getElementById('fila-prontos').innerHTML += '<td id="' + RR[i][1]+ '" width="10%" style="background-color:' + RR[i][0] + ';"></td>';
                    }
                    rr();
                }
            }
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</body>

   